# AI漫导 (DirectorAI) 开发运行指南

## 项目分析

通过分析项目结构，这是一个基于 **Flutter 3.0+** 和 **Dart 3.0+** 开发的跨平台移动应用，主要功能是利用AI生成漫剧视频。

### 核心技术栈
- **Flutter 3.0+**: 跨平台UI框架
- **Dart 3.0+**: 编程语言
- **Provider**: 状态管理
- **Dio**: HTTP网络请求
- **AI模型**: 
  - GLM-4.7 (智谱AI): 智能编排与决策
  - gemini-2.5-flash-image-vip: 文本生成图片（通过第三方API调用）
  - veo3.1/veo3.1-components: 图片生成视频（通过第三方API调用）

### 项目结构
```
lib/
├── main.dart                 # 应用入口，主题配置
├── controllers/              # 控制器层
├── models/                   # 数据模型
├── providers/                # 状态管理
├── screens/                  # 页面组件
├── services/                 # 服务层
├── utils/                    # 工具类
└── widgets/                  # 自定义组件
```

## 开发运行步骤

### 1. 安装 Flutter SDK 和 Dart

Flutter SDK 已包含 Dart，无需单独安装。

#### 步骤1：下载 Flutter SDK
1. 访问 [Flutter 官网](https://flutter.dev/docs/get-started/install/windows) 下载最新的 Flutter SDK 压缩包
2. 解压到合适的位置，例如：`C:\src\flutter`

#### 步骤2：配置环境变量
1. 打开 **控制面板 > 系统和安全 > 系统 > 高级系统设置 > 环境变量**
2. 在 **用户变量** 中找到并选中 `Path`，点击 **编辑**
3. 点击 **新建**，添加 Flutter 的 bin 目录路径，例如：`C:\src\flutter\bin`
4. 点击 **确定** 保存所有更改

#### 步骤3：验证安装
1. 打开命令提示符 (CMD) 或 PowerShell
2. 运行以下命令检查 Flutter 安装情况：
   ```bash
   flutter doctor
   ```
   这个命令会检查开发环境并报告任何缺失的依赖项

### 2. 安装 Android 开发环境

#### 方案A：完整安装（推荐，适合新手）
1. 访问 [Android Studio 官网](https://developer.android.com/studio) 下载最新版本
2. 运行安装程序，按照提示完成安装
3. 在安装过程中，确保勾选 **Android Virtual Device** 选项
4. 打开 Android Studio，进入 **Settings > Appearance & Behavior > System Settings > Android SDK**
5. 确保安装了以下组件：
   - **Android SDK Platform-Tools**
   - **Android SDK Build-Tools** (最新版本)
   - 至少一个 **Android SDK Platform** (建议 Android 13 或更高)
   - **Intel x86 Emulator Accelerator (HAXM installer)** (用于加速模拟器)
6. 配置环境变量：
   - `ANDROID_HOME`: 设置为 Android SDK 目录，例如：`C:\Users\用户名\AppData\Local\Android\Sdk`
   - 在 `Path` 中添加：`%ANDROID_HOME%\platform-tools` 和 `%ANDROID_HOME%\tools`

#### 方案B：仅安装必要工具（适合有经验的开发者）
如果不想安装完整的 Android Studio，可以只安装必要的 Android 开发工具：

1. **安装 JDK 11+**（Flutter 3.0+ 要求）
   - 访问 [Oracle JDK 官网](https://www.oracle.com/java/technologies/downloads/) 或 [OpenJDK](https://adoptium.net/) 下载并安装
   - 配置环境变量 `JAVA_HOME` 指向 JDK 安装目录

2. **安装 Android Command Line Tools**
   - 访问 [Android 开发者官网](https://developer.android.com/studio#command-tools) 下载 Command Line Tools
   - 解压到合适位置，例如：`C:\Android\cmdline-tools`
   - 在该目录下创建 `latest` 文件夹，并将所有文件移动到其中，最终路径为：`C:\Android\cmdline-tools\latest\bin`
   - 将 `C:\Android\cmdline-tools\latest\bin` 添加到系统环境变量 `Path`

3. **安装 Android SDK 组件**
   - 打开命令提示符，运行以下命令：
     ```bash
     sdkmanager --sdk_root=C:\Android\sdk "platform-tools" "build-tools;34.0.0" "platforms;android-34" "extras;google;usb_driver"
     ```
   - 配置环境变量：
     - `ANDROID_HOME`: 设置为 `C:\Android\sdk`
     - 在 `Path` 中添加：`%ANDROID_HOME%\platform-tools`

4. **安装 VS Code 扩展**
   - 打开 VS Code，安装以下扩展：
     - Flutter
     - Dart
     - Android SDK Command-line Tools

### 3. 测试设备选择

#### 选项1：使用 Android 模拟器

##### 方案A：通过 Android Studio 创建（推荐）
1. 打开 Android Studio
2. 点击 **AVD Manager** 图标创建虚拟设备
3. 选择设备类型和系统镜像
4. 启动模拟器

##### 方案B：使用第三方模拟器
1. 安装第三方模拟器，如：
   - [Genymotion](https://www.genymotion.com/)（高性能，支持多种设备）
   - [BlueStacks](https://www.bluestacks.com/)（主要用于游戏，但也可用于开发测试）
   - [LDPlayer](https://www.ldplayer.net/)（轻量级，适合日常开发）
2. 启动模拟器后，运行 `adb devices` 确认设备已连接

#### 选项2：使用真机测试
1. **启用开发者选项**：
   - 在手机上打开 **设置 > 关于手机**
   - 连续点击 **版本号** 7次，启用开发者选项
2. **启用 USB 调试**：
   - 进入 **设置 > 开发者选项**
   - 开启 **USB调试** 和 **USB安装** 选项
3. **连接手机**：
   - 使用 USB 数据线将手机连接到电脑
   - 在手机上授权电脑的调试请求
4. **验证连接**：
   - 打开命令提示符，运行 `adb devices`
   - 如果看到设备列表，表示连接成功

### 4. 克隆项目并安装依赖

#### 步骤1：克隆项目
1. 打开命令提示符，导航到你想要存放项目的目录
2. 运行以下命令克隆项目：
   ```bash
   git clone https://github.com/freestylefly/director_ai.git
   cd director_ai
   ```
   如果你没有 Git，可以直接下载项目 ZIP 文件并解压

#### 步骤2：安装依赖
1. 在项目根目录下运行以下命令：
   ```bash
   flutter pub get
   ```
   这个命令会下载并安装项目所需的所有依赖



### 5. 配置 API Token

#### 步骤1：获取 API Token
1. 访问 [智谱 AI 官网](https://open.bigmodel.cn/) 注册并获取 API Token
2. 访问 [Google AI Studio](https://aistudio.google.com/) 获取 Google API Key

#### 步骤2：配置 Token
1. 在项目中找到 `lib/services/api_config_service.dart` 文件
2. 编辑该文件，添加你的 API Token
   或在应用运行时通过设置界面动态配置

### 5. 运行项目

#### 步骤1：连接测试设备
1. **使用模拟器**：启动之前创建的 Android 模拟器（通过 Android Studio、Genymotion 或其他第三方模拟器）
2. **使用真机**：确保手机已开启 USB 调试并连接到电脑，运行 `adb devices` 确认设备已连接

#### 步骤2：运行应用
1. **使用 VS Code**：
   - 打开项目目录
   - 按 `F5` 键或点击右上角的 "Run" 按钮
   - 选择要运行的设备

2. **使用命令行**：
   - 在项目根目录下运行以下命令：
     ```bash
     flutter run
     ```
   - Flutter 会自动检测并连接到设备，然后编译并安装应用
   - 等待应用启动完成

### 6. 开发调试

- **热重载**: 在命令行中按 `r` 键可以快速重载应用
- **热重启**: 按 `R` 键可以重启应用
- **调试**: 可以使用 Android Studio 或 VS Code 进行调试

## 注意事项

1. **Flutter 版本**: 确保使用 Flutter 3.0 或更高版本
2. **Android SDK**: 建议使用 Android 13 或更高版本的 SDK
3. **API Token**: 不要将 API Token 提交到版本控制系统
4. **模拟器性能**: 如果模拟器运行缓慢，可以启用硬件加速
5. **依赖问题**: 如果遇到依赖冲突，可以尝试运行 `flutter pub upgrade` 更新依赖

## 常见问题排查

1. **flutter doctor 报错**: 根据提示安装缺失的依赖项
2. **模拟器无法启动**: 检查是否安装了 HAXM 或其他加速工具
3. **应用编译失败**: 检查是否配置了正确的 API Token 和依赖项
4. **网络请求失败**: 检查网络连接和 API Token 配置

## 开发建议

1. **使用 VS Code**: 推荐使用 VS Code 配合 Flutter 插件进行开发
2. **学习资源**: 建议学习 Flutter 和 Dart 的基础知识
3. **代码规范**: 遵循项目的代码规范，使用 `flutter analyze` 检查代码
4. **测试**: 定期运行 `flutter test` 执行单元测试

现在你已经完成了所有的开发环境配置，可以开始开发和运行 AI 漫导应用了！