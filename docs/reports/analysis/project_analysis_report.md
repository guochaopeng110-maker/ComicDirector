# 项目分析报告：AI 漫导 (AI ComicDirector)

## 1. 项目概述与原始需求

### 1.1 核心价值主张
本项目旨在构建一款移动应用（"DirectorAI"），允许用户通过简单的文字描述一键生成完整的短视频（或“漫剧”）。其 MVP（最小可行性产品）的核心目标是利用智能体（Agent）工作流实现 **“一键生成视频”**。

### 1.2 关键功能 (MVP)
*   **聊天界面**：用户输入创意的对话式 UI。
*   **AI 智能体编排**：使用核心“导演”智能体 (GLM-4.7) 规划视频内容。
*   **自动剧本创作**：将用户创意转化为结构化剧本（场景、旁白、提示词）。
*   **视觉一致性**：特别关注跨生成帧的角色一致性（使用角色卡/三视图方案）。
*   **多模态生成**：
    *   **文生剧本**：GLM-4.7。
    *   **文/图生图**：Gemini / 豆包 / Tuzi API（用于分镜）。
    *   **图生视频**：Veo3.1 / Sora (通过 Tuzi API)。
*   **视频合成**：将生成的片段合并为最终的 MP4 文件。

### 1.3 架构
项目采用 Flutter 中的 **Controller-Service-Model** 架构，并利用 **ReAct (Reasoning + Acting)** 模式构建 AI 智能体。
*   **大脑 (Brain)**：GLM-4.7 (规划与脚本)。
*   **执行者 (Worker)**：图像与视频生成 API。
*   **状态管理**：Provider (Flutter)。

---

## 2. 文档结构与改进计划

### 2.1 当前状态
`docs/` 目录目前包含混合的功能规范、技术笔记和规划文档。
*   `docs/需求和待办/`: 包含原始需求。
*   `docs/视频生成完整流程.md`: 优秀的架构概览。
*   `docs/一致性解决方案.md`: 关于角色一致性的技术深度文档。

### 2.2 建议结构
建议将 `docs/` 重组为标准化结构以支持未来开发：

```text
docs/
├── 01_requirements/        # 需求、用户故事、MVP 定义
│   ├── original_requirements.md
│   └── roadmap.md
├── 02_design/             # 架构、UI/UX 流程、一致性逻辑
│   ├── architecture_overview.md (即原 视频生成完整流程.md)
│   └── consistency_mechanism.md
├── 03_api/                # API 集成详情 (密钥管理、端点)
│   └── api_integration_guide.md
├── 04_manuals/            # 用户指南、部署指南
│   └── deployment_guide.md
└── reports/               # 分析报告 (如本文档)
```

### 2.3 立即执行的行动
1.  **整合需求**：将分散的需求文件移动到 `01_requirements`。
2.  **标准化技术文档**：规范化架构和 API 文档。
3.  **更新部署指南**：`deploy` 文件夹需要一份正确的 Flutter 应用构建和发布指南。

---

## 3. 工程完成度评估

### 3.1 已完成 / 已实现
*   **核心工作流**：`ScreenplayController` 实现了完整流水线：`剧本 -> 图片 -> 视频`。
*   **API 集成**：`ApiService` 已完全构建，支持：
    *   智谱 GLM-4.7 (聊天与剧本)。
    *   Tuzi API (用于图片与视频)。
    *   豆包 ARK (用于图片理解)。
*   **并发处理**：实现了场景的并行生成（`concurrentScenes` 配置）。
*   **角色一致性**：代码中包含“角色参考”和“用户原图”（图生图）的逻辑。
*   **错误处理**：具备基本的 try-catch 块和重试机制（手动重试）。

### 3.2 待办 / 需关注
*   **稳健性**：依赖外部代理 API (Tuzi) 意味着稳定性取决于第三方可用性。
*   **Mock/开发模式**：`ApiService` 有硬编码的 "Mock" 开关。建议在生产环境中使用更好的配置管理（如 `.env` 或构建风味）。
*   **UI/UX 打磨**：逻辑虽已具备，但“聊天”界面需要更优雅地处理边缘情况（如中途 API 失败）。
*   **视频合成**：`VideoMergerService` 已存在，但需要在多种 Android 设备上进行稳健性测试以确保兼容性。

---

## 4. 迭代与未来规划

### 4.1 短期 (稳定性与 MVP 打磨)
*   **配置管理**：将敏感 API 密钥和环境标志（Mock vs Real）移动到安全存储或构建配置中。
*   **重试逻辑**：针对瞬时 API 失败（图片/视频生成经常失败）实现自动重试。
*   **缓存/存储**：确保生成的资源被妥善缓存或清理，以节省设备存储空间。

### 4.2 中期 (功能扩展)
*   **提示词工程**：优化 GLM 生成的英文提示词，以提高视频质量（风格一致性）。
*   **高级一致性**：如果未来 API 允许，实现“FaceID”或基于 LoRA 的一致性。
*   **社交功能**：使用原生分享表单将生成的视频精准分享到各大平台。

### 4.3 长期
*   **自定义模型**：微调一个小模型以适应特定的“漫画”风格。
*   **云端渲染**：如果移动端处理太慢或耗电过大，将“合成”步骤卸载到服务器。
